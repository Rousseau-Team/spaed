# SPAED: Segmentation of PhAge Endolysin Domains using the predicted aligned error (PAE) matrix of Alphafold2


## Installation & usage

**From pypi**:
```
pip install numpy, pandas, scipy, spaed

python
import spaed
```

ex. `spaed(pae_path, output_file="spaed_predictions.csv")`


**From docker/apptainer**:
```
apptainer fetch spaed
```

ex. `apptainer run spaed protID_predicted_aligned_error.json --output_file spaed_predictions.csv`


**From source**:
```
git clone https://github.com/Rousseau-Team/spaed.git

pip install numpy pandas scipy
```

ex. `./src/spaed/spaed.py pae_path`



## Advanced usage
**Positional arguments**:
- **pae_path** - Folder of or singular PAE file in json format as outputted by Alphafold2/Colabfold.


**Optional arguments**:
- **output_file** - File to save table of segmented domains in csv format. (default spaed_predictions.csv)
- **MAX_CLUSTERS** - Maximum number of clusters initially generated by hierarchical clustering (default "dynamic"). By default will use a value equal to len(protein) // 10. Can also accept any integer. (default 'dynamic').
- **MIN_DOMAIN_SIZE** - Minimum size a domain can have. (default 30).
- **PAE_SCORE_CUTOFF** - Cutoff on the PAE score used to make adjustments to predicted domains/linkers/disordered regions. Residues with PAE score < PAE_SCORE_CUTOFF are considered close together. (default = 5).
- **MIN_DISORDERED_SIZE** - Minimum size a disordered region can be to be interesting enough to separate from the domain it is next to (default 20).
- **FREQ_DISORDERED** - For a given residue in the PAE matrix, frequency of residues that can align to it with a low PAE score and still be considered "not part of a domain". Values <MIN_DOMAIN_SIZE are logical, but as it increases, the more leniant the algorithm becomes to disordered regions (more will be predicted). (default 6).
- **PROP_DISORDERED** - Proportion of residues in a given region that must meet FREQ_DISORDERED criteria to be considered a disordered region. The greater the value, the stricter the criteria to predict the region as disordered. (default 80%).
- **FREQ_LINKER** - For a given residue in the PAE matrix, frequency of residues that can align to it with a low PAE score and still be considered as part of the linker. Values < MIN_DOMAIN_SIZE are logical as they are less than the expected size of the nearest domain. Increasing leads to a more leniant assignment of residues as part of the linker. (default 15).

MAX_CLUSTERS refers to the # of clusters the hierarchical clustering (in scipy) should try to create. A higher number than the number of domains you expect to observe should be used. This is to allow flexible regions (like the ends of the sequences or the linker regions) to be assigned to their own clusters. By default we use one tenth of the length of the protein, but you can manually set this value to any integer.

If you are interested in looking at the disordered regions in N- or C-terminal, consider increasing FREQ_DISORDERED (~30), decreasing MIN_DISORDERED_SIZE (~10) or decreasing PROP_DISORDERED (~50). This will result in more disordered regions being detected, but also many false positives. I would not change them all at the same time as this will probably increase the sensitivity too much.

If you are interested in linkers, consider modifying the FREQ_LINKER parameter (~4-30). This value is used to adjust the boundaries of the linkers and as such, a higher value will result in longer linkers, but will not detect new linkers.
